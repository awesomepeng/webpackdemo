{"version":3,"sources":["../../src/values/NativeFunctionValue.js"],"names":["NativeFunctionValue","constructor","realm","intrinsicName","name","length","callback","$ThisMode","$HomeObject","undefined","$FunctionKind","$Call","thisArgument","argsList","$Realm","$ConstructorKind","$Construct","argumentsList","newTarget","$Environment","$GlobalEnv","$DefineOwnProperty","value","writable","configurable","enumerable","$Description","throwIfNotConcreteString","getTrackedPropertyNames","trackedPropertyNames","hasDefaultLength","getLength","getName","callCallback","context","originalArgsList","originalLength","slice","i","intrinsics","currentLocation","concat"],"mappings":";;;;;;AAaA;;AAYA;;AACA;;AAQA;AAlCA;;;;;;;;;AASA;;AA0Be,MAAMA,mBAAN,wCAA0D;AACvEC,cACEC,KADF,EAEEC,aAFF,EAGEC,IAHF,EAIEC,MAJF,EAKEC,QALF,EAMEL,cAAwB,IAN1B,EAOE;AACA,UAAMC,KAAN,EAAaC,aAAb;;AAEA,SAAKI,SAAL,GAAiB,QAAjB;AACA,SAAKC,WAAL,GAAmBC,SAAnB;AACA,SAAKC,aAAL,GAAqB,QAArB;;AAEA,SAAKC,KAAL,GAAa,CAACC,YAAD,EAAeC,QAAf,KAA4B;AACvC,aAAO,sBAAUF,KAAV,CAAgB,KAAKG,MAArB,EAA6B,IAA7B,EAAmCF,YAAnC,EAAiDC,QAAjD,CAAP;AACD,KAFD;;AAIA,QAAIZ,WAAJ,EAAiB;AACf,WAAKc,gBAAL,GAAwB,MAAxB;AACA,WAAKC,UAAL,GAAkB,CAACC,aAAD,EAAgBC,SAAhB,KAA8B;AAC9C,eAAO,sBAAUF,UAAV,CAAqB,KAAKF,MAA1B,EAAkC,IAAlC,EAAwCG,aAAxC,EAAuDC,SAAvD,CAAP;AACD,OAFD;AAGD;;AAED,SAAKC,YAAL,GAAoBjB,MAAMkB,UAA1B;;AAEA,SAAKd,QAAL,GAAgBA,QAAhB;AACA,SAAKD,MAAL,GAAcA,MAAd;;AAEA,SAAKgB,kBAAL,CAAwB,QAAxB,EAAkC;AAChCC,aAAO,uBAAgBpB,KAAhB,EAAuBG,MAAvB,CADyB;AAEhCkB,gBAAU,KAFsB;AAGhCC,oBAAc,IAHkB;AAIhCC,kBAAY;AAJoB,KAAlC;;AAOA,QAAIrB,SAASK,SAAT,IAAsBL,SAAS,EAAnC,EAAuC;AACrC,UAAIA,kCAAJ,EAAiC;AAC/B,aAAKA,IAAL,GAAYA,KAAKsB,YAAL,GAAqB,IAAGtB,KAAKsB,YAAL,CAAkBC,wBAAlB,GAA6CL,KAAM,GAA3E,GAAgF,UAA5F;AACD,OAFD,MAEO;AACL,aAAKlB,IAAL,GAAYA,IAAZ;AACD;AACD,WAAKiB,kBAAL,CAAwB,MAAxB,EAAgC;AAC9BC,eAAO,uBAAgBpB,KAAhB,EAAuB,KAAKE,IAA5B,CADuB;AAE9BmB,kBAAU,KAFoB;AAG9BC,sBAAc,IAHgB;AAI9BC,oBAAY;AAJkB,OAAhC;AAMD,KAZD,MAYO;AACL,WAAKrB,IAAL,GAAY,QAAZ;AACD;AACF;;AAIDwB,4BAAyC;AACvC,WAAO5B,oBAAoB6B,oBAA3B;AACD;;AAEDC,qBAA4B;AAC1B,WAAO,KAAKC,SAAL,OAAqB,KAAK1B,MAAjC;AACD;;AAMD;AACA2B,YAAkB;AAChB,WAAO,KAAK5B,IAAZ;AACD;;AAED6B,eACEC,OADF,EAEEC,gBAFF,EAGEjB,SAHF,EAIoB;AAClB,QAAIkB,iBAAiBD,iBAAiB9B,MAAtC;AACA,QAAIQ,WAAWsB,iBAAiBE,KAAjB,EAAf;AACA,SAAK,IAAIC,IAAI,CAAb,EAAgBA,IAAI,KAAKjC,MAAzB,EAAiCiC,GAAjC,EAAsC;AACpCzB,eAASyB,CAAT,IAAcH,iBAAiBG,CAAjB,KAAuB,KAAKxB,MAAL,CAAYyB,UAAZ,CAAuB9B,SAA5D;AACD;AACD,WAAO,kCACL,KAAKH,QAAL,CAAc4B,OAAd,EAAuBrB,QAAvB,EAAiCuB,cAAjC,EAAiDlB,SAAjD,CADK,EAELT,SAFK,EAGL,KAAKK,MAAL,CAAY0B,eAHP,CAAP;AAKD;;AAED;;;AAGA;;;AAIA;AAlGuE;kBAApDxC,mB;AAAAA,mB,CAuDZ6B,oB,GAAuB,mBAAYA,oBAAZ,CAAiCY,MAAjC,CAAwC,iBAAxC,C","file":"NativeFunctionValue.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport type { Value } from \"./index.js\";\nimport type { Realm } from \"../realm.js\";\nimport { SymbolValue } from \"./index.js\";\nimport {\n  NumberValue,\n  StringValue,\n  ECMAScriptFunctionValue,\n  ObjectValue,\n  NullValue,\n  ProxyValue,\n  UndefinedValue,\n  AbstractObjectValue,\n} from \"./index.js\";\nimport type { PromiseCapability } from \"../types.js\";\nimport { ReturnCompletion } from \"../completions.js\";\nimport { Functions } from \"../singletons.js\";\nexport type NativeFunctionCallback = (\n  context: UndefinedValue | NullValue | ObjectValue | AbstractObjectValue,\n  args: Array<Value>,\n  argLength: number,\n  newTarget?: void | ObjectValue\n) => Value;\n\n/* Built-in Function Objects */\nexport default class NativeFunctionValue extends ECMAScriptFunctionValue {\n  constructor(\n    realm: Realm,\n    intrinsicName: void | string,\n    name: void | string | SymbolValue,\n    length: number,\n    callback: NativeFunctionCallback,\n    constructor?: boolean = true\n  ) {\n    super(realm, intrinsicName);\n\n    this.$ThisMode = \"strict\";\n    this.$HomeObject = undefined;\n    this.$FunctionKind = \"normal\";\n\n    this.$Call = (thisArgument, argsList) => {\n      return Functions.$Call(this.$Realm, this, thisArgument, argsList);\n    };\n\n    if (constructor) {\n      this.$ConstructorKind = \"base\";\n      this.$Construct = (argumentsList, newTarget) => {\n        return Functions.$Construct(this.$Realm, this, argumentsList, newTarget);\n      };\n    }\n\n    this.$Environment = realm.$GlobalEnv;\n\n    this.callback = callback;\n    this.length = length;\n\n    this.$DefineOwnProperty(\"length\", {\n      value: new NumberValue(realm, length),\n      writable: false,\n      configurable: true,\n      enumerable: false,\n    });\n\n    if (name !== undefined && name !== \"\") {\n      if (name instanceof SymbolValue) {\n        this.name = name.$Description ? `[${name.$Description.throwIfNotConcreteString().value}]` : \"[native]\";\n      } else {\n        this.name = name;\n      }\n      this.$DefineOwnProperty(\"name\", {\n        value: new StringValue(realm, this.name),\n        writable: false,\n        configurable: true,\n        enumerable: false,\n      });\n    } else {\n      this.name = \"native\";\n    }\n  }\n\n  static trackedPropertyNames = ObjectValue.trackedPropertyNames.concat(\"$RevocableProxy\");\n\n  getTrackedPropertyNames(): Array<string> {\n    return NativeFunctionValue.trackedPropertyNames;\n  }\n\n  hasDefaultLength(): boolean {\n    return this.getLength() === this.length;\n  }\n\n  name: string;\n  callback: NativeFunctionCallback;\n  length: number;\n\n  // Override.\n  getName(): string {\n    return this.name;\n  }\n\n  callCallback(\n    context: UndefinedValue | NullValue | ObjectValue | AbstractObjectValue,\n    originalArgsList: Array<Value>,\n    newTarget?: void | ObjectValue\n  ): ReturnCompletion {\n    let originalLength = originalArgsList.length;\n    let argsList = originalArgsList.slice();\n    for (let i = 0; i < this.length; i++) {\n      argsList[i] = originalArgsList[i] || this.$Realm.intrinsics.undefined;\n    }\n    return new ReturnCompletion(\n      this.callback(context, argsList, originalLength, newTarget),\n      undefined,\n      this.$Realm.currentLocation\n    );\n  }\n\n  // for Proxy\n  $RevocableProxy: void | NullValue | ProxyValue;\n\n  // for Promise resolve/reject functions\n  $Promise: ?ObjectValue;\n  $AlreadyResolved: void | { value: boolean };\n\n  // for Promise resolve functions\n  $Capability: void | PromiseCapability;\n  $AlreadyCalled: void | { value: boolean };\n  $Index: void | number;\n  $Values: void | Array<Value>;\n  $Capabilities: void | PromiseCapability;\n  $RemainingElements: void | { value: number };\n}\n"]}