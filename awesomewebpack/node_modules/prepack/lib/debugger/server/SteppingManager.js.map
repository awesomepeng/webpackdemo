{"version":3,"sources":["../../../src/debugger/server/SteppingManager.js"],"names":["SteppingManager","constructor","realm","keepOldSteppers","_realm","_steppers","_keepOldSteppers","processStepCommand","kind","currentNodeLocation","_processStepIn","_processStepOver","_processStepOut","loc","source","push","start","line","column","contextStack","length","getAndDeleteCompletedSteppers","ast","i","completedSteppers","stepper","isComplete","splice"],"mappings":";;;;;;;AAWA;;AACA;;;;AACA;;;;AAIO,MAAMA,eAAN,CAAsB;AAC3BC,cAAYC,KAAZ,EAA0BC,eAA1B,EAAqD;AACnD,SAAKC,MAAL,GAAcF,KAAd;AACA,SAAKG,SAAL,GAAiB,EAAjB;AACA,SAAKC,gBAAL,GAAwB,KAAxB;AACA,QAAIH,oBAAoB,IAAxB,EAA8B,KAAKG,gBAAL,GAAwB,IAAxB;AAC/B;;;AAKDC,qBAAmBC,IAAnB,EAAgDC,mBAAhD,EAAoG;AAClG,QAAID,SAAS,IAAb,EAAmB;AACjB,WAAKE,cAAL,CAAoBD,mBAApB;AACD,KAFD,MAEO,IAAID,SAAS,MAAb,EAAqB;AAC1B,WAAKG,gBAAL,CAAsBF,mBAAtB;AACD,KAFM,MAEA,IAAID,SAAS,KAAb,EAAoB;AACzB,WAAKI,eAAL,CAAqBH,mBAArB;AACD,KAFM,MAEA;AACL,+BAAU,KAAV,EAAkB,sBAAqBD,IAAK,EAA5C;AACD;AACF;;AAEDE,iBAAeG,GAAf,EAAmD;AACjD,6BAAUA,OAAOA,IAAIC,MAArB;AACA,QAAI,CAAC,KAAKR,gBAAV,EAA4B;AAC1B,WAAKD,SAAL,GAAiB,EAAjB;AACD;AACD,SAAKA,SAAL,CAAeU,IAAf,CACE,6BAAoBF,IAAIC,MAAxB,EAAgCD,IAAIG,KAAJ,CAAUC,IAA1C,EAAgDJ,IAAIG,KAAJ,CAAUE,MAA1D,EAAkE,KAAKd,MAAL,CAAYe,YAAZ,CAAyBC,MAA3F,CADF;AAGD;;AAEDT,mBAAiBE,GAAjB,EAAqD;AACnD,6BAAUA,OAAOA,IAAIC,MAArB;AACA,QAAI,CAAC,KAAKR,gBAAV,EAA4B;AAC1B,WAAKD,SAAL,GAAiB,EAAjB;AACD;AACD,SAAKA,SAAL,CAAeU,IAAf,CACE,6BAAoBF,IAAIC,MAAxB,EAAgCD,IAAIG,KAAJ,CAAUC,IAA1C,EAAgDJ,IAAIG,KAAJ,CAAUE,MAA1D,EAAkE,KAAKd,MAAL,CAAYe,YAAZ,CAAyBC,MAA3F,CADF;AAGD;;AAEDR,kBAAgBC,GAAhB,EAAoD;AAClD,6BAAUA,OAAOA,IAAIC,MAArB;AACA,QAAI,CAAC,KAAKR,gBAAV,EAA4B;AAC1B,WAAKD,SAAL,GAAiB,EAAjB;AACD;AACD,SAAKA,SAAL,CAAeU,IAAf,CACE,4BAAmBF,IAAIC,MAAvB,EAA+BD,IAAIG,KAAJ,CAAUC,IAAzC,EAA+CJ,IAAIG,KAAJ,CAAUE,MAAzD,EAAiE,KAAKd,MAAL,CAAYe,YAAZ,CAAyBC,MAA1F,CADF;AAGD;;AAEDC,gCAA8BC,GAA9B,EAAsE;AACpE,6BAAUA,IAAIT,GAAJ,IAAWS,IAAIT,GAAJ,CAAQC,MAA7B;AACA,QAAIS,IAAI,CAAR;AACA,QAAIC,oBAA4C,EAAhD;AACA,WAAOD,IAAI,KAAKlB,SAAL,CAAee,MAA1B,EAAkC;AAChC,UAAIK,UAAU,KAAKpB,SAAL,CAAekB,CAAf,CAAd;AACA,UAAIE,QAAQC,UAAR,CAAmBJ,GAAnB,EAAwB,KAAKlB,MAAL,CAAYe,YAAZ,CAAyBC,MAAjD,CAAJ,EAA8D;AAC5DI,0BAAkBT,IAAlB,CAAuBU,OAAvB;AACA,aAAKpB,SAAL,CAAesB,MAAf,CAAsBJ,CAAtB,EAAyB,CAAzB;AACD,OAHD,MAGO;AACLA;AACD;AACF;AACD,WAAOC,iBAAP;AACD;AAnE0B;QAAhBxB,e,GAAAA,e,EAjBb;;;;;;;;;AASA","file":"SteppingManager.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow strict-local */\n\nimport { BabelNodeSourceLocation } from \"babel-types\";\nimport invariant from \"./../common/invariant.js\";\nimport { Stepper, StepIntoStepper, StepOverStepper, StepOutStepper } from \"./Stepper.js\";\nimport type { Realm } from \"./../../realm.js\";\nimport type { StoppableObject } from \"./StopEventManager.js\";\n\nexport class SteppingManager {\n  constructor(realm: Realm, keepOldSteppers?: boolean) {\n    this._realm = realm;\n    this._steppers = [];\n    this._keepOldSteppers = false;\n    if (keepOldSteppers === true) this._keepOldSteppers = true;\n  }\n  _realm: Realm;\n  _keepOldSteppers: boolean;\n  _steppers: Array<Stepper>;\n\n  processStepCommand(kind: \"in\" | \"over\" | \"out\", currentNodeLocation: BabelNodeSourceLocation): void {\n    if (kind === \"in\") {\n      this._processStepIn(currentNodeLocation);\n    } else if (kind === \"over\") {\n      this._processStepOver(currentNodeLocation);\n    } else if (kind === \"out\") {\n      this._processStepOut(currentNodeLocation);\n    } else {\n      invariant(false, `Invalid step type: ${kind}`);\n    }\n  }\n\n  _processStepIn(loc: BabelNodeSourceLocation): void {\n    invariant(loc && loc.source);\n    if (!this._keepOldSteppers) {\n      this._steppers = [];\n    }\n    this._steppers.push(\n      new StepIntoStepper(loc.source, loc.start.line, loc.start.column, this._realm.contextStack.length)\n    );\n  }\n\n  _processStepOver(loc: BabelNodeSourceLocation): void {\n    invariant(loc && loc.source);\n    if (!this._keepOldSteppers) {\n      this._steppers = [];\n    }\n    this._steppers.push(\n      new StepOverStepper(loc.source, loc.start.line, loc.start.column, this._realm.contextStack.length)\n    );\n  }\n\n  _processStepOut(loc: BabelNodeSourceLocation): void {\n    invariant(loc && loc.source);\n    if (!this._keepOldSteppers) {\n      this._steppers = [];\n    }\n    this._steppers.push(\n      new StepOutStepper(loc.source, loc.start.line, loc.start.column, this._realm.contextStack.length)\n    );\n  }\n\n  getAndDeleteCompletedSteppers(ast: BabelNode): Array<StoppableObject> {\n    invariant(ast.loc && ast.loc.source);\n    let i = 0;\n    let completedSteppers: Array<StoppableObject> = [];\n    while (i < this._steppers.length) {\n      let stepper = this._steppers[i];\n      if (stepper.isComplete(ast, this._realm.contextStack.length)) {\n        completedSteppers.push(stepper);\n        this._steppers.splice(i, 1);\n      } else {\n        i++;\n      }\n    }\n    return completedSteppers;\n  }\n}\n"]}