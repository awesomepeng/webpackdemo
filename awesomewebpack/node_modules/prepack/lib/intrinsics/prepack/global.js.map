{"version":3,"sources":["../../../src/intrinsics/prepack/global.js"],"names":["createAbstractFunction","realm","global","$GlobalObject","$DefineOwnProperty","value","context","args","console","log","map","arg","serialize","writable","enumerable","configurable","intrinsics","null","undefined","ObjectPrototype","additionalFunctionUid","config","assignToGlobal","t","memberExpression","identifier","createErrorThrowCompletion","TypeError","react","enabled","reactComponentRootUid","component","hasValidComponent","hasValidConfig","diagnostic","currentLocation","handleError","reactComponentTree","$Set","functionValue","$Call","functionCall","evaluatePure","createNativeFunctionForResidualCall","unsafe","typeNameOrTemplate","f","useAbstractInterpretation","type","template","isTypeCompatibleWith","constructor","isResidual","isUnsafeResidual","result","createTemporalFromBuildFunction","concat","nodes","callExpression","slice","makePartial","values","Set","generator","rebuildNestedProperties","getIdentifier","name","createNativeFunctionForResidualInjection","initializeAndValidateArgs","buildNode_","numArgs","ciArgs","emitStatement","c","s","mightBeTrue","error","pushAndRefine","errorLiteral","stringLiteral","ifStatement","unaryExpression","blockStatement","throwStatement","newExpression","object","isTop","makeFinal","option","makeSimple","propertyName","invariantOptions","key","ToStringPartial","emitConcreteModel","invariantLevel","invariantOptionString","emitPropertyInvariant","mightBeUndefined","emitFullInvariant","neverCheckProperty","markPropertyAsChecked","intrinsicName","rebuildObjectProperty","$Realm","__IntrospectionError","additionalValues","_name","options"],"mappings":"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","file":"global.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\nimport {\n  AbstractObjectValue,\n  AbstractValue,\n  BooleanValue,\n  ConcreteValue,\n  ECMAScriptSourceFunctionValue,\n  FunctionValue,\n  IntegralValue,\n  NativeFunctionValue,\n  ObjectValue,\n  StringValue,\n  Value,\n} from \"../../values/index.js\";\nimport { To, Path } from \"../../singletons.js\";\nimport { ValuesDomain } from \"../../domains/index.js\";\nimport * as t from \"babel-types\";\nimport type { BabelNodeExpression, BabelNodeSpreadElement } from \"babel-types\";\nimport invariant from \"../../invariant.js\";\nimport { createAbstract, parseTypeNameOrTemplate } from \"./utils.js\";\nimport { describeValue } from \"../../utils.js\";\nimport { valueIsKnownReactAbstraction } from \"../../react/utils.js\";\nimport { CompilerDiagnostic, FatalError } from \"../../errors.js\";\n\nexport function createAbstractFunction(realm: Realm, ...additionalValues: Array<ConcreteValue>): NativeFunctionValue {\n  return new NativeFunctionValue(\n    realm,\n    \"global.__abstract\",\n    \"__abstract\",\n    0,\n    (context, [typeNameOrTemplate, _name, options]) => {\n      let name = _name;\n      if (name instanceof StringValue) name = name.value;\n      if (name !== undefined && typeof name !== \"string\") {\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"intrinsic name argument is not a string\");\n      }\n      if (options && !(options instanceof ObjectValue)) {\n        throw realm.createErrorThrowCompletion(\n          realm.intrinsics.TypeError,\n          \"options must be an ObjectValue if provided\"\n        );\n      }\n      return createAbstract(realm, typeNameOrTemplate, name, options, ...additionalValues);\n    }\n  );\n}\n\nexport default function(realm: Realm): void {\n  let global = realm.$GlobalObject;\n\n  global.$DefineOwnProperty(\"__dump\", {\n    value: new NativeFunctionValue(realm, \"global.__dump\", \"__dump\", 0, (context, args) => {\n      console.log(\"dump\", args.map(arg => arg.serialize()));\n      return context;\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function to model values that are obtained from the environment,\n  // and whose concrete values are not known at Prepack-time.\n  // __abstract(typeNameOrTemplate, name, options) creates a new abstract value\n  // where typeNameOrTemplate can be...\n  // - 'string', 'boolean', 'number', 'object', 'function' or\n  // - ':string', ':boolean', ':number', ':object', ':function' to indicate that\n  //   the abstract value represents a function that only returns values of the specified type, or\n  // - an actual object defining known properties.\n  // options is an optional object that may contain:\n  // - allowDuplicateNames: boolean representing whether the name of the abstract value may be\n  //   repeated, by default they must be unique\n  // If the abstract value gets somehow embedded in the final heap,\n  // it will be referred to by the supplied name in the generated code.\n  global.$DefineOwnProperty(\"__abstract\", {\n    value: createAbstractFunction(realm),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__abstractOrNull\", {\n    value: createAbstractFunction(realm, realm.intrinsics.null),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__abstractOrNullOrUndefined\", {\n    value: createAbstractFunction(realm, realm.intrinsics.null, realm.intrinsics.undefined),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__abstractOrUndefined\", {\n    value: createAbstractFunction(realm, realm.intrinsics.undefined),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__optimizedFunctions\", {\n    value: new ObjectValue(\n      realm,\n      realm.intrinsics.ObjectPrototype,\n      \"__optimizedFunctions\",\n      /* refuseSerialization */ true\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  let additionalFunctionUid = 0;\n  // Allows dynamically registering optimized functions.\n  // WARNING: these functions will get exposed at global scope and called there.\n  // NB: If we interpret one of these calls in an evaluateForEffects context\n  //     that is not subsequently applied, the function will not be registered\n  //     (because prepack won't have a correct value for the FunctionValue itself)\n  global.$DefineOwnProperty(\"__optimize\", {\n    value: new NativeFunctionValue(realm, \"global.__optimize\", \"__optimize\", 1, (context, [value, config]) => {\n      // only optimize functions for now\n      if (value instanceof ECMAScriptSourceFunctionValue || value instanceof AbstractValue) {\n        realm.assignToGlobal(\n          t.memberExpression(\n            t.memberExpression(t.identifier(\"global\"), t.identifier(\"__optimizedFunctions\")),\n            t.identifier(\"\" + additionalFunctionUid++)\n          ),\n          value\n        );\n      } else {\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"Called __optimize on an invalid type\");\n      }\n      return value;\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  if (realm.react.enabled) {\n    global.$DefineOwnProperty(\"__reactComponentTrees\", {\n      value: new ObjectValue(\n        realm,\n        realm.intrinsics.ObjectPrototype,\n        \"__reactComponentTrees\",\n        /* refuseSerialization */ true\n      ),\n      writable: true,\n      enumerable: false,\n      configurable: true,\n    });\n    let reactComponentRootUid = 0;\n    global.$DefineOwnProperty(\"__optimizeReactComponentTree\", {\n      value: new NativeFunctionValue(\n        realm,\n        \"global.__optimizeReactComponentTree\",\n        \"__optimizeReactComponentTree\",\n        0,\n        (context, [component, config]) => {\n          let hasValidComponent =\n            component instanceof ECMAScriptSourceFunctionValue || valueIsKnownReactAbstraction(realm, component);\n          let hasValidConfig =\n            config instanceof ObjectValue || config === realm.intrinsics.undefined || config === undefined;\n\n          if (!hasValidComponent || !hasValidConfig) {\n            let diagnostic = new CompilerDiagnostic(\n              \"__optimizeReactComponentTree(rootComponent, config) has been called with invalid arguments\",\n              realm.currentLocation,\n              \"PP0024\",\n              \"FatalError\"\n            );\n            realm.handleError(diagnostic);\n            if (realm.handleError(diagnostic) === \"Fail\") throw new FatalError();\n          }\n          let reactComponentTree = new ObjectValue(realm, realm.intrinsics.ObjectPrototype);\n          reactComponentTree.$Set(\"rootComponent\", component, reactComponentTree);\n          reactComponentTree.$Set(\"config\", config || realm.intrinsics.undefined, reactComponentTree);\n\n          realm.assignToGlobal(\n            t.memberExpression(\n              t.memberExpression(t.identifier(\"global\"), t.identifier(\"__reactComponentTrees\")),\n              t.identifier(\"\" + reactComponentRootUid++)\n            ),\n            reactComponentTree\n          );\n          return component;\n        }\n      ),\n      writable: true,\n      enumerable: false,\n      configurable: true,\n    });\n  }\n\n  global.$DefineOwnProperty(\"__evaluatePureFunction\", {\n    value: new NativeFunctionValue(\n      realm,\n      \"global.__evaluatePureFunction\",\n      \"__evaluatePureFunction\",\n      0,\n      (context, [functionValue]) => {\n        invariant(functionValue instanceof ECMAScriptSourceFunctionValue);\n        invariant(typeof functionValue.$Call === \"function\");\n        let functionCall: Function = functionValue.$Call;\n        return realm.evaluatePure(() => functionCall(realm.intrinsics.undefined, []), /*reportSideEffectFunc*/ null);\n      }\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Maps from initialized moduleId to exports object\n  // NB: Changes to this shouldn't ever be serialized\n  global.$DefineOwnProperty(\"__initializedModules\", {\n    value: new ObjectValue(\n      realm,\n      realm.intrinsics.ObjectPrototype,\n      \"__initializedModules\",\n      /* refuseSerialization */ true\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Set of property bindings whose invariant got checked\n  // NB: Changes to this shouldn't ever be serialized\n  global.$DefineOwnProperty(\"__checkedBindings\", {\n    value: new ObjectValue(\n      realm,\n      realm.intrinsics.ObjectPrototype,\n      \"__checkedBindings\",\n      /* refuseSerialization */ true\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function used to instantiate a residual function\n  function createNativeFunctionForResidualCall(unsafe: boolean): NativeFunctionValue {\n    return new NativeFunctionValue(\n      realm,\n      \"global.__residual\",\n      \"__residual\",\n      2,\n      (context, [typeNameOrTemplate, f, ...args]) => {\n        if (!realm.useAbstractInterpretation) {\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"realm is not partial\");\n        }\n\n        let { type, template } = parseTypeNameOrTemplate(realm, typeNameOrTemplate);\n\n        if (!Value.isTypeCompatibleWith(f.constructor, FunctionValue)) {\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"cannot determine residual function\");\n        }\n        invariant(f instanceof FunctionValue);\n        f.isResidual = true;\n        if (unsafe) f.isUnsafeResidual = true;\n        let result = AbstractValue.createTemporalFromBuildFunction(realm, type, [f].concat(args), nodes =>\n          t.callExpression(nodes[0], ((nodes.slice(1): any): Array<BabelNodeExpression | BabelNodeSpreadElement>))\n        );\n        if (template) {\n          invariant(\n            result instanceof AbstractValue,\n            \"the nested properties should only be rebuilt for an abstract value\"\n          );\n          template.makePartial();\n          result.values = new ValuesDomain(new Set([template]));\n          invariant(realm.generator);\n          realm.rebuildNestedProperties(result, result.getIdentifier().name);\n        }\n        return result;\n      }\n    );\n  }\n\n  function createNativeFunctionForResidualInjection(\n    name: string,\n    initializeAndValidateArgs: (Array<Value>) => void,\n    buildNode_: (Array<BabelNodeExpression>) => BabelNodeStatement,\n    numArgs: number\n  ): NativeFunctionValue {\n    return new NativeFunctionValue(realm, \"global.\" + name, name, numArgs, (context, ciArgs) => {\n      initializeAndValidateArgs(ciArgs);\n      invariant(realm.generator !== undefined);\n      realm.generator.emitStatement(ciArgs, buildNode_);\n      return realm.intrinsics.undefined;\n    });\n  }\n\n  // Helper function that specifies a dynamic invariant that cannot be evaluated at prepack time, and needs code to\n  // be injected into the serialized output.\n  global.$DefineOwnProperty(\"__assume\", {\n    value: createNativeFunctionForResidualInjection(\n      \"__assume\",\n      ([c, s]): void => {\n        if (!c.mightBeTrue()) {\n          let error = new CompilerDiagnostic(\n            `Assumed condition cannot hold`,\n            realm.currentLocation,\n            \"PP0038\",\n            \"FatalError\"\n          );\n          realm.handleError(error);\n          throw new FatalError();\n        }\n        Path.pushAndRefine(c);\n      },\n      ([c, s]: Array<BabelNodeExpression>) => {\n        let errorLiteral = s.type === \"StringLiteral\" ? s : t.stringLiteral(\"Assumption violated\");\n        return t.ifStatement(\n          t.unaryExpression(\"!\", c),\n          t.blockStatement([t.throwStatement(t.newExpression(t.identifier(\"Error\"), [errorLiteral]))])\n        );\n      },\n      2\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function that identifies a computation that must remain part of the residual program and cannot be partially evaluated,\n  // e.g. because it contains a loop over abstract values.\n  // __residual(typeNameOrTemplate, function, arg0, arg1, ...) creates a new abstract value\n  // that is computed by invoking function(arg0, arg1, ...) in the residual program and\n  // where typeNameOrTemplate either either 'string', 'boolean', 'number', 'object', or an actual object defining known properties.\n  // The function must not have side effects, and it must not access any state (besides the supplied arguments).\n  global.$DefineOwnProperty(\"__residual\", {\n    value: createNativeFunctionForResidualCall(false),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function that identifies a variant of the residual function that has implicit dependencies. This version of residual will infer the dependencies\n  // and rewrite the function body to do the same thing as the original residual function.\n  global.$DefineOwnProperty(\"__residual_unsafe\", {\n    value: createNativeFunctionForResidualCall(true),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Internal helper function for tests.\n  // __isAbstract(value) checks if a given value is abstract.\n  global.$DefineOwnProperty(\"__isAbstract\", {\n    value: new NativeFunctionValue(realm, \"global.__isAbstract\", \"__isAbstract\", 1, (context, [value]) => {\n      return new BooleanValue(realm, value instanceof AbstractValue);\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // __makePartial(object) marks an (abstract) object as partial.\n  global.$DefineOwnProperty(\"__makePartial\", {\n    value: new NativeFunctionValue(realm, \"global.__makePartial\", \"__makePartial\", 1, (context, [object]) => {\n      if (object instanceof AbstractObjectValue || object instanceof ObjectValue) {\n        object.makePartial();\n        return object;\n      }\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an (abstract) object\");\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__makeFinal\", {\n    value: new NativeFunctionValue(realm, \"global.__makeFinal\", \"__makeFinal\", 1, (context, [object]) => {\n      if (object instanceof ObjectValue || (object instanceof AbstractObjectValue && !object.values.isTop())) {\n        object.makeFinal();\n        return object;\n      }\n      throw realm.createErrorThrowCompletion(\n        realm.intrinsics.TypeError,\n        \"not an object or abstract object value (non-top)\"\n      );\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // __makeSimple(object) marks an (abstract) object as one that has no getters or setters.\n  global.$DefineOwnProperty(\"__makeSimple\", {\n    value: new NativeFunctionValue(realm, \"global.__makeSimple\", \"__makeSimple\", 1, (context, [object, option]) => {\n      if (object instanceof AbstractObjectValue || object instanceof ObjectValue) {\n        object.makeSimple(option);\n        return object;\n      }\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an (abstract) object\");\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  // Helper function that emits a check whether a given object property has a particular value.\n  global.$DefineOwnProperty(\"__assumeDataProperty\", {\n    value: new NativeFunctionValue(\n      realm,\n      \"global.__assumeDataProperty\",\n      \"__assumeDataProperty\",\n      3,\n      (context, [object, propertyName, value, invariantOptions]) => {\n        if (!realm.useAbstractInterpretation) {\n          throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"realm is not partial\");\n        }\n\n        if (object instanceof AbstractObjectValue || object instanceof ObjectValue) {\n          let generator = realm.generator;\n          invariant(generator);\n\n          let key = To.ToStringPartial(realm, propertyName);\n\n          if (realm.emitConcreteModel) {\n            generator.emitConcreteModel(key, value);\n          } else if (realm.invariantLevel >= 1) {\n            let invariantOptionString = invariantOptions\n              ? To.ToStringPartial(realm, invariantOptions)\n              : \"FULL_INVARIANT\";\n            switch (invariantOptionString) {\n              // checks (!property in object || object.property === undefined)\n              case \"VALUE_DEFINED_INVARIANT\":\n                generator.emitPropertyInvariant(object, key, value.mightBeUndefined() ? \"PRESENT\" : \"DEFINED\");\n                break;\n              case \"SKIP_INVARIANT\":\n                break;\n              case \"FULL_INVARIANT\":\n                generator.emitFullInvariant((object: any), key, value);\n                break;\n              default:\n                invariant(false, \"Invalid invariantOption \" + invariantOptionString);\n            }\n            if (!realm.neverCheckProperty(object, key)) realm.markPropertyAsChecked(object, key);\n          }\n          realm.generator = undefined; // don't emit code during the following $Set call\n          // casting to due to Flow workaround above\n          (object: any).$Set(key, value, object);\n          realm.generator = generator;\n          if (object.intrinsicName) realm.rebuildObjectProperty(object, key, value, object.intrinsicName);\n          return context.$Realm.intrinsics.undefined;\n        }\n\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not an (abstract) object\");\n      }\n    ),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__IntrospectionError\", {\n    value: realm.intrinsics.__IntrospectionError,\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__isIntegral\", {\n    value: new NativeFunctionValue(realm, \"global.__isIntegral\", \"__isIntegral\", 1, (context, [value]) => {\n      return new BooleanValue(realm, value instanceof IntegralValue);\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n\n  global.$DefineOwnProperty(\"__describe\", {\n    value: new NativeFunctionValue(realm, \"global.__describe\", \"__describe\", 1, (context, [value]) => {\n      return new StringValue(realm, describeValue(value));\n    }),\n    writable: true,\n    enumerable: false,\n    configurable: true,\n  });\n}\n"]}